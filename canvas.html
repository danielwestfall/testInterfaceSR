<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>A11y Canvas Widget with Hidden Mirror</title>
<style>
  body {
    font-family: Arial, sans-serif;
    padding: 20px;
    max-width: 600px;
    margin: auto;
  }
  button {
    cursor: pointer;
  }
  #canvasContainer {
    position: relative;
  }
  canvas {
    border: 1px solid #ccc;
    display: block;
    margin-top: 10px;
    width: 100%;
    height: auto;
  }
  /* Offscreen but accessible mirror inside the canvas container */
  #mirror {
    position: absolute;
    width: 1px;
    height: 1px;
    margin: 0;
    padding: 0;
    overflow: hidden;
    clip: rect(0 0 0 0);
    clip-path: inset(100%);
    border: 0;
    white-space: nowrap;
  }
  /* Focus styles for mirror elements (for testing) */
  #mirror h2:focus,
  #mirror p:focus,
  #mirror button:focus {
    outline: 3px solid #000000;
    outline-offset: 2px;
  }
  #mirror img:focus {
  outline: 3px solid #ff0000;
  outline-offset: 2px;
}
</style>
</head>
<body>

<h1>Accessible Canvas Widget with Hidden Mirror</h1>

<div id="canvasContainer" aria-live="polite" aria-atomic="true">
  <canvas id="myCanvas" width="560" height="320" role="img" aria-label="Interactive canvas with heading, text, photo, and button" tabindex="0"></canvas>

  <!-- Offscreen mirror inside the canvas container -->
<div id="mirror" aria-hidden="false" tabindex="-1">
  <h2 id="mirror-heading" tabindex="0">Canvas Heading</h2>
  <p id="mirror-new-text" tabindex="0">Welcome to an accessible canvas element.</p>
  <p id="mirror-text" tabindex="0" lang="es">Bienvenido a un elemento de lienzo accesible.</p>
  <img id="mirror-image" src="placeholder.png" alt="Placeholder image of a search file icon" tabindex="0" />
  <button id="mirror-button">Click Me</button>
</div>
</div>

<script>
(() => {
  const canvas = document.getElementById('myCanvas');
  const ctx = canvas.getContext('2d');

  const mirrorHeading = document.getElementById('mirror-heading');
  const mirrorText = document.getElementById('mirror-text');
  const mirrorNewText = document.getElementById('mirror-new-text'); // New variable for the new text
  const mirrorImage = document.getElementById('mirror-image');
  const mirrorButton = document.getElementById('mirror-button');

  // Update the focusItems array to include the new text
  const focusItems = [mirrorHeading, mirrorNewText, mirrorText, mirrorImage, mirrorButton];
  let focusIndex = -1;

  function drawCanvas(focusIdx = -1) {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Draw heading
    ctx.font = '28px Arial';
    ctx.fillStyle = focusIdx === 0 ? 'gold' : 'black';
    ctx.fillText('Canvas Heading', 20, 50);

    // Draw translated text
    ctx.font = '18px Arial';
    ctx.fillStyle = focusIdx === 1 ? 'gold' : 'black';
    ctx.fillText('Welcome to an accessible canvas element.', 20, 90);

    // Draw the new line of text
    ctx.fillStyle = focusIdx === 2 ? 'gold' : 'black'; // New focus state
    ctx.fillText('Bienvenido a un elemento de lienzo accesible.', 20, 115);

    // Draw image
    const img = new Image();
    img.onload = () => {
      ctx.drawImage(img, 20, 140, 150, 150); // Adjust Y position for the new text

      // Draw focus outline on image if focused
      if (focusIdx === 3) {
        ctx.strokeStyle = 'yellow';
        ctx.lineWidth = 4;
        ctx.strokeRect(20, 140, 150, 150);
      }
    };
    img.src = 'placeholder.png';

    // Draw button rectangle
    ctx.fillStyle = focusIdx === 4 ? '#004a99' : '#007BFF'; // Update index for button focus
    ctx.fillRect(200, 260, 130, 50); // Adjust Y position
    ctx.fillStyle = 'white';
    ctx.font = '20px Arial';
    ctx.fillText('Click Me', 225, 295); // Adjust Y position

    // Draw focus outline on button if focused
    if (focusIdx === 4) {
      ctx.strokeStyle = 'yellow';
      ctx.lineWidth = 4;
      ctx.strokeRect(200, 260, 130, 50);
    }
  }

  drawCanvas();

  canvas.addEventListener('keydown', (e) => {
    if (e.key === 'Tab') {
      e.preventDefault();
      const active = document.activeElement;
      let idx = focusItems.indexOf(active);
      if (e.shiftKey) {
        idx = idx <= 0 ? focusItems.length - 1 : idx - 1;
      } else {
        idx = idx === -1 ? 0 : (idx + 1) % focusItems.length;
      }
      focusItems[idx].focus();
    }
  });

  focusItems.forEach((el, idx) => {
    el.addEventListener('focus', () => {
      focusIndex = idx;
      drawCanvas(focusIndex);
    });
  });

  canvas.addEventListener('click', (e) => {
    const rect = canvas.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;

    // Update coordinates to match the button's new position
    if (x >= 200 && x <= 330 && y >= 260 && y <= 310) {
      mirrorButton.click();
    }
  });

  mirrorButton.addEventListener('click', () => {
    alert('You clicked the canvas button!');
  });
})();
</script>

</body>
</html>
