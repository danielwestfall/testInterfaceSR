<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RM Screen Reader Playground</title>
    <link rel="stylesheet" href="style.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
  </head>
  <body>
    <header class="top-row">
      <h1>Screen Reader RM Tester (Shift + F10 for context menu)</h1>
      <div class="header-buttons">
        <button>Refresh</button>
        <button>Exit</button>
      </div>
    </header>

    <section class="toolbar-row">
      <div class="toolbar-col pagination-col">
        <button aria-label="Previous Page">
          <i class="fas fa-chevron-left"></i>
        </button>
        <button aria-label="Go to Home Page">
          <i class="fas fa-home"></i>
        </button>
        <button aria-label="Next Page">
          <i class="fas fa-chevron-right"></i>
        </button>
      </div>

      <div class="toolbar-col controls-col">
        <label for="number-select" class="visually-hidden">Select Number</label>
        <select id="number-select" name="number">
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
          <option value="6">6</option>
          <option value="7">7</option>
          <option value="8">8</option>
        </select>
        <div class="search-container">
          <i class="fas fa-search search-icon" aria-hidden="true"></i>
          <input
            type="search"
            id="search-field"
            placeholder="Search..."
            aria-label="Search Resources"
          />
        </div>

        <div
          role="radiogroup"
          aria-label="View Options"
          class="button-radio-group toolbar-radio-group"
        >
          <button role="radio" aria-checked="true" class="radio-button">
            List View
          </button>
          <button role="radio" aria-checked="false" class="radio-button">
            Icon View
          </button>
        </div>
      </div>

      <div class="toolbar-col actions-col">
        <button>Menu</button>
        <button>Help</button>
      </div>
    </section>

    <main class="main-content-area">
      <div class="app-row">
        <aside class="app-col left-col">
          <div
            class="left-col-fixed"
            role="radiogroup"
            aria-label="Navigation Mode"
          >
            <button
              role="radio"
              aria-checked="true"
              class="radio-button full-width"
            >
              Topic Index
            </button>
            <button
              role="radio"
              aria-checked="false"
              class="radio-button full-width"
            >
              Resource Sets
            </button>
          </div>
          <div class="left-col-scrollable">
            <div class="accordion-container">
              <details class="accordion-item">
                <summary>Tempo</summary>
                <div>
                  <button class="accordion-content-button">Largo</button>
                  <button class="accordion-content-button">Adagio</button>
                  <button class="accordion-content-button">Andante</button>
                  <button class="accordion-content-button">Moderato</button>
                  <button class="accordion-content-button">Allegro</button>
                  <button class="accordion-content-button">Presto</button>
                </div>
              </details>
              <details class="accordion-item">
                <summary>Dynamics</summary>
                <div>
                  <button class="accordion-content-button">
                    Pianissimo (pp)
                  </button>
                  <button class="accordion-content-button">Piano (p)</button>
                  <button class="accordion-content-button">
                    Mezzo-forte (mf)
                  </button>
                  <button class="accordion-content-button">Forte (f)</button>
                  <button class="accordion-content-button">
                    Fortissimo (ff)
                  </button>
                  <button class="accordion-content-button">Crescendo</button>
                  <button class="accordion-content-button">Diminuendo</button>
                </div>
              </details>
              <details class="accordion-item">
                <summary>Articulation</summary>
                <div>
                  <button class="accordion-content-button">Staccato</button>
                  <button class="accordion-content-button">Legato</button>
                  <button class="accordion-content-button">Accent</button>
                  <button class="accordion-content-button">Marcato</button>
                  <button class="accordion-content-button">Tenuto</button>
                </div>
              </details>
              <details class="accordion-item">
                <summary>Melody & Harmony</summary>
                <div>
                  <button class="accordion-content-button">Scale</button>
                  <button class="accordion-content-button">Chord</button>
                  <button class="accordion-content-button">Arpeggio</button>
                  <button class="accordion-content-button">Interval</button>
                  <button class="accordion-content-button">Cadence</button>
                </div>
              </details>
              <details class="accordion-item">
                <summary>Rhythm</summary>
                <div>
                  <button class="accordion-content-button">Quarter Note</button>
                  <button class="accordion-content-button">Half Note</button>
                  <button class="accordion-content-button">Eighth Note</button>
                  <button class="accordion-content-button">Syncopation</button>
                  <button class="accordion-content-button">
                    Time Signature
                  </button>
                </div>
              </details>
              <details class="accordion-item">
                <summary>Form</summary>
                <div>
                  <button class="accordion-content-button">Verse</button>
                  <button class="accordion-content-button">Chorus</button>
                  <button class="accordion-content-button">Bridge</button>
                  <button class="accordion-content-button">Coda</button>
                  <button class="accordion-content-button">Rondo</button>
                </div>
              </details>
              <details class="accordion-item">
                <summary>Texture</summary>
                <div>
                  <button class="accordion-content-button">Monophonic</button>
                  <button class="accordion-content-button">Homophonic</button>
                  <button class="accordion-content-button">Polyphonic</button>
                </div>
              </details>
              <details class="accordion-item">
                <summary>Timbre</summary>
                <div>
                  <button class="accordion-content-button">Bright</button>
                  <button class="accordion-content-button">Dark</button>
                  <button class="accordion-content-button">Mellow</button>
                </div>
              </details>
              <details class="accordion-item">
                <summary>Tonality</summary>
                <div>
                  <button class="accordion-content-button">Major</button>
                  <button class="accordion-content-button">Minor</button>
                  <button class="accordion-content-button">Atonal</button>
                </div>
              </details>
              <details class="accordion-item">
                <summary>Instrumentation</summary>
                <div>
                  <button class="accordion-content-button">Strings</button>
                  <button class="accordion-content-button">Brass</button>
                  <button class="accordion-content-button">Woodwinds</button>
                  <button class="accordion-content-button">Percussion</button>
                </div>
              </details>
              <details class="accordion-item">
                <summary>Intervals</summary>
                <div>
                  <button class="accordion-content-button">
                    Perfect Fifth
                  </button>
                  <button class="accordion-content-button">Major Third</button>
                  <button class="accordion-content-button">
                    Minor Seventh
                  </button>
                  <button class="accordion-content-button">Octave</button>
                </div>
              </details>
              <details class="accordion-item">
                <summary>Techniques</summary>
                <div>
                  <button class="accordion-content-button">Vibrato</button>
                  <button class="accordion-content-button">Pizzicato</button>
                  <button class="accordion-content-button">Glissando</button>
                </div>
              </details>
              <details class="accordion-item">
                <summary>Ornaments</summary>
                <div>
                  <button class="accordion-content-button">Trill</button>
                  <button class="accordion-content-button">Mordent</button>
                  <button class="accordion-content-button">Turn</button>
                </div>
              </details>
              <details class="accordion-item">
                <summary>General Terms</summary>
                <div>
                  <button class="accordion-content-button">Phrase</button>
                  <button class="accordion-content-button">Motif</button>
                  <button class="accordion-content-button">Ostinato</button>
                  <button class="accordion-content-button">Sequence</button>
                </div>
              </details>
              <details class="accordion-item">
                <summary>Clefs</summary>
                <div>
                  <button class="accordion-content-button">Treble Clef</button>
                  <button class="accordion-content-button">Bass Clef</button>
                  <button class="accordion-content-button">Alto Clef</button>
                </div>
              </details>
              <details class="accordion-item">
                <summary>Improvisation</summary>
                <div>
                  <button class="accordion-content-button">Solo</button>
                  <button class="accordion-content-button">
                    Call and Response
                  </button>
                </div>
              </details>
            </div>
          </div>
        </aside>

        <section class="app-col center-col">
          <div class="center-col-fixed">
            <div
              role="tablist"
              aria-label="Resource Type Filters"
              aria-orientation="horizontal"
            >
              <button
                role="tab"
                id="tab-all"
                aria-controls="panel-all"
                aria-selected="true"
                tabindex="0"
              >
                All (XXX)
              </button>
              <button
                role="tab"
                id="tab-interactives"
                aria-controls="panel-interactives"
                aria-selected="false"
                tabindex="-1"
              >
                Interactives (XXX)
              </button>
              <button
                role="tab"
                id="tab-songs"
                aria-controls="panel-songs"
                aria-selected="false"
                tabindex="-1"
              >
                Songs (XXX)
              </button>
              <button
                role="tab"
                id="tab-lessons"
                aria-controls="panel-lessons"
                aria-selected="false"
                tabindex="-1"
              >
                Lessons (XXX)
              </button>
              <button
                role="tab"
                id="tab-assessments"
                aria-controls="panel-assessments"
                aria-selected="false"
                tabindex="-1"
              >
                Assessments (XXX)
              </button>
              <button
                role="tab"
                id="tab-video"
                aria-controls="panel-video"
                aria-selected="false"
                tabindex="-1"
              >
                Video (XXX)
              </button>
              <button
                role="tab"
                id="tab-audio"
                aria-controls="panel-audio"
                aria-selected="false"
                tabindex="-1"
              >
                Audio (XXX)
              </button>
              <button
                role="tab"
                id="tab-printables"
                aria-controls="panel-printables"
                aria-selected="false"
                tabindex="-1"
              >
                Printables (XXX)
              </button>
            </div>
          </div>
          <div class="center-col-scrollable">
            <div
              role="tabpanel"
              id="panel-all"
              aria-labelledby="tab-all"
              tabindex="0"
            >
              <div class="thumbnail-grid">
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Label 1</span>
                </button>
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Label 2</span>
                </button>
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Label 3</span>
                </button>
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Label 4</span>
                </button>
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Label 5</span>
                </button>
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Label 6</span>
                </button>
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Label 7</span>
                </button>
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Label 8</span>
                </button>
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Label 9</span>
                </button>
              </div>
              <nav class="content-pagination" aria-label="Resource Pagination">
                <button aria-label="Previous Results Page">
                  <i class="fas fa-chevron-left"></i>
                </button>
                <span>1 of 99</span>
                <button aria-label="Next Results Page">
                  <i class="fas fa-chevron-right"></i>
                </button>
              </nav>
            </div>

            <div
              role="tabpanel"
              id="panel-interactives"
              aria-labelledby="tab-interactives"
              tabindex="0"
              hidden
            >
              <div class="thumbnail-grid">
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Interactive 1</span>
                </button>
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Interactive 2</span>
                </button>
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Interactive 3</span>
                </button>
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Interactive 4</span>
                </button>
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Interactive 5</span>
                </button>
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Interactive 6</span>
                </button>
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Interactive 7</span>
                </button>
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Interactive 8</span>
                </button>
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Interactive 9</span>
                </button>
              </div>
              <nav class="content-pagination" aria-label="Resource Pagination">
                <button aria-label="Previous Results Page">
                  <i class="fas fa-chevron-left"></i>
                </button>
                <span>1 of 42</span>
                <button aria-label="Next Results Page">
                  <i class="fas fa-chevron-right"></i>
                </button>
              </nav>
            </div>

            <div
              role="tabpanel"
              id="panel-songs"
              aria-labelledby="tab-songs"
              tabindex="0"
              hidden
            >
              <div class="thumbnail-grid">
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Song 1</span>
                </button>
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Song 2</span>
                </button>
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Song 3</span>
                </button>
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Song 4</span>
                </button>
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Song 5</span>
                </button>
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Song 6</span>
                </button>
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Song 7</span>
                </button>
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Song 8</span>
                </button>
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Song 9</span>
                </button>
              </div>
              <nav class="content-pagination" aria-label="Resource Pagination">
                <button aria-label="Previous Results Page">
                  <i class="fas fa-chevron-left"></i>
                </button>
                <span>1 of 4</span>
                <button aria-label="Next Results Page">
                  <i class="fas fa-chevron-right"></i>
                </button>
              </nav>
            </div>

            <div
              role="tabpanel"
              id="panel-lessons"
              aria-labelledby="tab-lessons"
              tabindex="0"
              hidden
            >
              <div class="thumbnail-grid">
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Lesson 1</span>
                </button>
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Lesson 2</span>
                </button>
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Lesson 3</span>
                </button>
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Lesson 4</span>
                </button>
              </div>
              <nav class="content-pagination" aria-label="Resource Pagination">
                <button aria-label="Previous Results Page">
                  <i class="fas fa-chevron-left"></i>
                </button>
                <span>1 of 1</span>
                <button aria-label="Next Results Page">
                  <i class="fas fa-chevron-right"></i>
                </button>
              </nav>
            </div>

            <div
              role="tabpanel"
              id="panel-assessments"
              aria-labelledby="tab-assessments"
              tabindex="0"
              hidden
            >
              <div class="thumbnail-grid">
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Assessment 1</span>
                </button>
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Assessment 2</span>
                </button>
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Assessment 3</span>
                </button>
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Assessment 4</span>
                </button>
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Assessment 5</span>
                </button>
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Assessment 6</span>
                </button>
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Assessment 7</span>
                </button>
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Assessment 8</span>
                </button>
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Assessment 9</span>
                </button>
              </div>
              <nav class="content-pagination" aria-label="Resource Pagination">
                <button aria-label="Previous Results Page">
                  <i class="fas fa-chevron-left"></i>
                </button>
                <span>1 of 5</span>
                <button aria-label="Next Results Page">
                  <i class="fas fa-chevron-right"></i>
                </button>
              </nav>
            </div>

            <div
              role="tabpanel"
              id="panel-video"
              aria-labelledby="tab-video"
              tabindex="0"
              hidden
            >
              <div class="thumbnail-grid">
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Video 1</span>
                </button>
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Video 2</span>
                </button>
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Video 3</span>
                </button>
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Video 4</span>
                </button>
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Video 5</span>
                </button>
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Video 6</span>
                </button>
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Video 7</span>
                </button>
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Video 8</span>
                </button>
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Video 9</span>
                </button>
              </div>
              <nav class="content-pagination" aria-label="Resource Pagination">
                <button aria-label="Previous Results Page">
                  <i class="fas fa-chevron-left"></i>
                </button>
                <span>1 of 8</span>
                <button aria-label="Next Results Page">
                  <i class="fas fa-chevron-right"></i>
                </button>
              </nav>
            </div>

            <div
              role="tabpanel"
              id="panel-audio"
              aria-labelledby="tab-audio"
              tabindex="0"
              hidden
            >
              <div class="thumbnail-grid">
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Audio 1</span>
                </button>
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Audio 2</span>
                </button>
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Audio 3</span>
                </button>
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Audio 4</span>
                </button>
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Audio 5</span>
                </button>
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Audio 6</span>
                </button>
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Audio 7</span>
                </button>
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Audio 8</span>
                </button>
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Audio 9</span>
                </button>
              </div>
              <nav class="content-pagination" aria-label="Resource Pagination">
                <button aria-label="Previous Results Page">
                  <i class="fas fa-chevron-left"></i>
                </button>
                <span>1 of 5</span>
                <button aria-label="Next Results Page">
                  <i class="fas fa-chevron-right"></i>
                </button>
              </nav>
            </div>

            <div
              role="tabpanel"
              id="panel-printables"
              aria-labelledby="tab-printables"
              tabindex="0"
              hidden
            >
              <div class="thumbnail-grid">
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Printable 1</span>
                </button>
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Printable 2</span>
                </button>
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Printable 3</span>
                </button>
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Printable 4</span>
                </button>
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Printable 5</span>
                </button>
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Printable 6</span>
                </button>
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Printable 7</span>
                </button>
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Printable 8</span>
                </button>
                <button class="thumbnail-button">
                  <div class="thumb-placeholder"></div>
                  <span>Printable 9</span>
                </button>
              </div>
              <nav class="content-pagination" aria-label="Resource Pagination">
                <button aria-label="Previous Results Page">
                  <i class="fas fa-chevron-left"></i>
                </button>
                <span>1 of 10</span>
                <button aria-label="Next Results Page">
                  <i class="fas fa-chevron-right"></i>
                </button>
              </nav>
            </div>
          </div>
        </section>

        <aside class="app-col right-col">
          <div class="right-col-fixed">
            <h2 id="resource-folders-heading">Resource Folders</h2>
          </div>
          <div class="right-col-scrollable">
            <ul
              role="tree"
              id="resource-tree"
              aria-labelledby="resource-folders-heading"
            >
              <li role="none">
                <button
                  role="treeitem"
                  data-depth="1"
                  aria-level="1"
                  aria-expanded="false"
                  tabindex="0"
                >
                  <i class="fas fa-folder" aria-hidden="true"></i> Lessons
                </button>
                <ul role="group" aria-label="Lessons" hidden>
                  <li role="none">
                    <a
                      href="#lesson1"
                      role="treeitem"
                      data-depth="2"
                      aria-level="2"
                      tabindex="-1"
                    >
                      <i class="fas fa-music" aria-hidden="true"></i> Lesson 1
                    </a>
                  </li>
                  <li role="none">
                    <a
                      href="#lesson2"
                      role="treeitem"
                      data-depth="2"
                      aria-level="2"
                      tabindex="-1"
                    >
                      <i class="fas fa-music" aria-hidden="true"></i> Lesson 2
                    </a>
                  </li>
                  <li role="none">
                    <button
                      role="treeitem"
                      data-depth="2"
                      aria-level="2"
                      aria-expanded="false"
                      tabindex="-1"
                    >
                      <i class="fas fa-folder" aria-hidden="true"></i> Grade 3
                      Lessons
                    </button>
                    <ul role="group" aria-label="Grade 3 Lessons" hidden>
                      <li role="none">
                        <a
                          href="#g3u1"
                          role="treeitem"
                          data-depth="3"
                          aria-level="3"
                          tabindex="-1"
                        >
                          <i class="fas fa-file-alt" aria-hidden="true"></i>
                          Unit 1 Overview
                        </a>
                      </li>
                      <li role="none">
                        <a
                          href="#g3u2"
                          role="treeitem"
                          data-depth="3"
                          aria-level="3"
                          tabindex="-1"
                        >
                          <i class="fas fa-file-alt" aria-hidden="true"></i>
                          Unit 2 Resources
                        </a>
                      </li>
                    </ul>
                  </li>
                </ul>
              </li>
              <li role="none">
                <button
                  role="treeitem"
                  data-depth="1"
                  aria-level="1"
                  aria-expanded="true"
                  tabindex="-1"
                >
                  <i class="fas fa-folder-open" aria-hidden="true"></i> My
                  Lessons
                </button>
                <ul role="group" aria-label="My Lessons">
                  <li role="none">
                    <a
                      href="#customA"
                      role="treeitem"
                      data-depth="2"
                      aria-level="2"
                      tabindex="-1"
                    >
                      <i class="fas fa-file-alt" aria-hidden="true"></i> Custom
                      Item A
                    </a>
                  </li>
                  <li role="none">
                    <button
                      role="treeitem"
                      data-depth="2"
                      aria-level="2"
                      aria-expanded="false"
                      tabindex="-1"
                    >
                      <i class="fas fa-folder" aria-hidden="true"></i> Subfolder
                      1
                    </button>
                    <ul role="group" aria-label="Subfolder 1" hidden>
                      <li role="none">
                        <a
                          href="#audio1"
                          role="treeitem"
                          data-depth="3"
                          aria-level="3"
                          tabindex="-1"
                        >
                          <i class="fas fa-file-audio" aria-hidden="true"></i>
                          Arrangement MP3
                        </a>
                      </li>
                      <li role="none">
                        <a
                          href="#sheet1"
                          role="treeitem"
                          data-depth="3"
                          aria-level="3"
                          tabindex="-1"
                        >
                          <i class="fas fa-file-pdf" aria-hidden="true"></i>
                          Sheet Music PDF
                        </a>
                      </li>
                    </ul>
                  </li>
                  <li role="none">
                    <a
                      href="#customB"
                      role="treeitem"
                      data-depth="2"
                      aria-level="2"
                      tabindex="-1"
                    >
                      <i class="fas fa-file-video" aria-hidden="true"></i>
                      Custom Video B
                    </a>
                  </li>
                </ul>
              </li>
              <li role="none">
                <a
                  href="#screens"
                  role="treeitem"
                  data-depth="1"
                  aria-level="1"
                  tabindex="-1"
                >
                  <i class="fas fa-desktop" aria-hidden="true"></i> My Screens
                </a>
              </li>
              <li role="none">
                <button
                  role="treeitem"
                  data-depth="1"
                  aria-level="1"
                  aria-expanded="false"
                  tabindex="-1"
                >
                  <i class="fas fa-folder" aria-hidden="true"></i> My Resources
                </button>
                <ul role="group" aria-label="My Resources" hidden>
                  <li role="none">
                    <a
                      href="#resource1"
                      role="treeitem"
                      data-depth="2"
                      aria-level="2"
                      tabindex="-1"
                    >
                      <i class="fas fa-image" aria-hidden="true"></i> Image 1
                    </a>
                  </li>
                </ul>
              </li>
              <li role="none">
                <a
                  href="#practice"
                  role="treeitem"
                  data-depth="1"
                  aria-level="1"
                  tabindex="-1"
                >
                  <i class="fas fa-folder" aria-hidden="true"></i> Practice
                  Folder
                </a>
              </li>
              <li role="none">
                <a
                  href="#favorites"
                  role="treeitem"
                  data-depth="1"
                  aria-level="1"
                  tabindex="-1"
                >
                  <i class="fas fa-star" aria-hidden="true"></i> Favorites
                </a>
              </li>
            </ul>
          </div>
        </aside>
      </div>
    </main>

    <div
      id="customContextMenu"
      role="menu"
      aria-label="Item Actions"
      class="custom-context-menu"
      hidden
    >
      <button role="menuitem" tabindex="-1">
        <i class="fas fa-play" aria-hidden="true"></i> Preview
      </button>
      <button role="menuitem" tabindex="-1">
        <i class="fas fa-pencil-alt" aria-hidden="true"></i> Rename
      </button>
      <button role="menuitem" tabindex="-1">
        <i class="fas fa-copy" aria-hidden="true"></i> Duplicate
      </button>
      <div role="separator" class="menu-separator"></div>
      <button role="menuitem" tabindex="-1">
        <i class="fas fa-folder-plus" aria-hidden="true"></i> Add to Folder...
      </button>
      <button role="menuitem" tabindex="-1">
        <i class="fas fa-share-alt" aria-hidden="true"></i> Share
      </button>
      <div role="separator" class="menu-separator"></div>
      <button role="menuitem" class="menuitem-danger" tabindex="-1">
        <i class="fas fa-trash-alt" aria-hidden="true"></i> Delete
      </button>
    </div>
    <div
      class="visually-hidden"
      id="status-live-region"
      role="status"
      aria-live="polite"
      aria-atomic="true"
    ></div>

    <div
      class="visually-hidden"
      id="alert-live-region"
      role="alert"
      aria-live="assertive"
      aria-atomic="true"
    ></div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        console.log("DOM fully loaded and parsed. Initializing scripts...");

        // --- Live Region Setup ---
        const statusLiveRegion = document.getElementById("status-live-region");
        const alertLiveRegion = document.getElementById("alert-live-region");

        function announceStatus(message) {
          if (statusLiveRegion) {
            statusLiveRegion.textContent = "";
            setTimeout(() => {
              statusLiveRegion.textContent = message;
              console.log("Announce Status:", message);
            }, 50);
          } else {
            console.warn("Status live region not found.");
          }
        }

        function announceAlert(message) {
          if (alertLiveRegion) {
            alertLiveRegion.textContent = "";
            setTimeout(() => {
              alertLiveRegion.textContent = message;
              console.warn("Announce Alert:", message);
            }, 50);
          } else {
            console.warn("Alert live region not found.");
          }
        }
        // --- End Live Region Setup ---

        // --- Tabs Implementation ---
        const tablist = document.querySelector(
          '[role="tablist"][aria-label="Resource Type Filters"]'
        ); // More specific selector
        if (tablist) {
          const tabs = Array.from(tablist.querySelectorAll('[role="tab"]'));
          // Assuming panels are within a container sibling to tablist container or globally queryable
          const panelsContainer = document.querySelector(
            ".center-col-scrollable"
          ); // Or appropriate container
          const panels = panelsContainer
            ? Array.from(
                panelsContainer.querySelectorAll(':scope > [role="tabpanel"]')
              )
            : [];

          function activateTab(selectedTab) {
            if (!selectedTab) return;
            let panelFound = false;
            tabs.forEach((tab) => {
              const isSelected = tab === selectedTab;
              const panelId = tab.getAttribute("aria-controls");
              // Find panel more robustly if panels aren't direct children/siblings
              const panel = document.getElementById(panelId); // Rely on ID

              tab.setAttribute("aria-selected", String(isSelected)); // Use string true/false
              tab.setAttribute("tabindex", isSelected ? "0" : "-1");

              if (panel) {
                panel.hidden = !isSelected;
                panelFound = panelFound || isSelected; // Track if the selected panel was found
              } else {
                console.error(
                  `Panel with ID ${panelId} not found for tab ${tab.id}`
                );
              }
            });
            // Announce after state changes
            const itemCount = panelsContainer
              ? panelsContainer.querySelector(
                  `[role="tabpanel"]:not([hidden]) .thumbnail-button`
                )?.length || 0
              : 0;
            const tabName = selectedTab.textContent.trim().split("(")[0].trim();
            announceStatus(
              `Showing ${itemCount > 0 ? itemCount : "content"} in ${tabName}.`
            ); // Adjusted announcement
          }

          if (tabs.length > 0 && panels.length > 0) {
            tablist.addEventListener("click", (e) => {
              const clickedTab = e.target.closest('[role="tab"]');
              if (!clickedTab) return;
              activateTab(clickedTab);
            });

            tablist.addEventListener("keydown", (e) => {
              const currentTab = e.target.closest('[role="tab"]'); // Use closest here too
              if (!currentTab) return;

              let newIndex;
              const currentIndex = tabs.indexOf(currentTab);
              const tabCount = tabs.length;

              switch (e.key) {
                case "ArrowRight":
                case "ArrowDown":
                  e.preventDefault();
                  newIndex = (currentIndex + 1) % tabCount;
                  break;
                case "ArrowLeft":
                case "ArrowUp":
                  e.preventDefault();
                  newIndex = (currentIndex - 1 + tabCount) % tabCount;
                  break;
                case "Home":
                  e.preventDefault();
                  newIndex = 0;
                  break;
                case "End":
                  e.preventDefault();
                  newIndex = tabCount - 1;
                  break;
                default:
                  return; // Exit if not a navigation key
              }

              if (newIndex !== undefined) {
                tabs[newIndex].focus();
                // Automatic Activation: Activate tab on focus change via keys
                activateTab(tabs[newIndex]);
              }
            });

            // Initial Setup
            let initiallyActiveTab = tabs.find(
              (tab) => tab.getAttribute("aria-selected") === "true"
            );
            if (!initiallyActiveTab && tabs.length > 0) {
              // If none are selected by default in HTML, select the first one
              initiallyActiveTab = tabs[0];
              initiallyActiveTab.setAttribute("aria-selected", "true");
              initiallyActiveTab.setAttribute("tabindex", "0");
            } else if (initiallyActiveTab) {
              // Ensure only the selected one has tabindex 0 initially
              tabs.forEach((tab) =>
                tab.setAttribute(
                  "tabindex",
                  tab === initiallyActiveTab ? "0" : "-1"
                )
              );
            }

            if (initiallyActiveTab) {
              activateTab(initiallyActiveTab); // Sync panels on load
            }
            console.log("Tabs initialized.");
          } else {
            console.warn("Tabs or Panels not found for initialization.");
          }
        } else {
          console.warn("Tablist not found.");
        }
        // --- End Tabs Implementation ---

        // --- Radio Button Group Implementation ---
        function setupRadioButtonGroup(groupElement) {
          if (!groupElement) return;
          const buttons = Array.from(
            groupElement.querySelectorAll('[role="radio"]')
          );
          if (buttons.length === 0) return;

          buttons.forEach((button) => {
            button.addEventListener("click", () => {
              if (button.getAttribute("aria-checked") === "true") return;
              buttons.forEach((btn) =>
                btn.setAttribute("aria-checked", "false")
              );
              button.setAttribute("aria-checked", "true");
              console.log(
                `Radio group "${groupElement.getAttribute(
                  "aria-label"
                )}": Selected "${button.textContent.trim()}"`
              );
              // announceStatus(`${groupElement.getAttribute('aria-label')} changed to ${button.textContent.trim()}`); // Optional announcement
            });
          });
          console.log(
            `Radio group initialized: ${
              groupElement.getAttribute("aria-label") || "Unnamed"
            }`
          );
        }

        setupRadioButtonGroup(document.querySelector(".toolbar-radio-group"));
        setupRadioButtonGroup(
          document.querySelector('.left-col-fixed[role="radiogroup"]')
        );
        // --- End Radio Button Group Implementation ---

        // --- ARIA Treeview Implementation (for role="treeitem" on button/a) ---
        const tree = document.getElementById("resource-tree");
        let setFocusableNode; // Declare function name in advance

        if (tree) {
          const focusableTreeNodes = Array.from(
            tree.querySelectorAll('[role="treeitem"]')
          );
          let typeaheadBuffer = "";
          let typeaheadTimeout = null;

          function getChildGroup(treeitemNode) {
            // treeitemNode is the button[role="treeitem"]
            if (
              treeitemNode.tagName !== "BUTTON" ||
              !treeitemNode.hasAttribute("aria-expanded")
            ) {
              // Only expandable buttons have child groups in this pattern
              return null;
            }
            // The group UL should be the next element sibling *of the button*
            const potentialGroup = treeitemNode.nextElementSibling;
            if (
              potentialGroup &&
              potentialGroup.tagName === "UL" &&
              potentialGroup.getAttribute("role") === "group"
            ) {
              return potentialGroup;
            }
            // Add log for debugging if group not found where expected
            console.error(
              `getChildGroup: Could not find group UL as the next sibling for button:`,
              treeitemNode,
              "Next sibling was:",
              potentialGroup
            );
            return null;
          }

          function getParentTreeitem(treeitemNode) {
            const parentLi = treeitemNode.parentElement;
            const parentGroup = parentLi?.parentElement;
            if (parentGroup && parentGroup.getAttribute("role") === "group") {
              const grandParentLi = parentGroup.parentElement;
              const parentTreeitem = grandParentLi?.querySelector(
                ':scope > [role="treeitem"]'
              );
              if (
                parentTreeitem &&
                (parentTreeitem.tagName === "BUTTON" ||
                  parentTreeitem.tagName === "A")
              ) {
                return parentTreeitem;
              }
            }
            return null;
          }

          function getVisibleFocusableNodes() {
            // Basic visibility check - refine if deeply nested hidden checks are needed
            return focusableTreeNodes.filter((node) => {
              let current = node.parentElement; // Start checking from li[role=none] parent
              while (current && current !== tree) {
                if (
                  current.getAttribute("role") === "group" &&
                  current.hidden
                ) {
                  return false;
                }
                // Check collapsed state of ancestor buttons
                const groupParent = current.closest('[role="group"]');
                if (groupParent) {
                  const parentLi = groupParent.parentElement;
                  const parentTreeitemButton = parentLi?.querySelector(
                    ':scope > button[role="treeitem"][aria-expanded="false"]'
                  );
                  if (parentTreeitemButton) {
                    return false; // Inside a collapsed node
                  }
                  current = parentLi?.parentElement; // Move up past the li
                } else {
                  current = current.parentElement; // General traverse up
                }
              }
              return true;
            });
          }

          // Define setFocusableNode here so it's in scope
          setFocusableNode = function (nodeToFocus) {
            // Assign to the outer variable
            if (!nodeToFocus) return;
            console.log(`TREEVIEW: Setting tabindex=0 for:`, nodeToFocus);
            focusableTreeNodes.forEach((node) => {
              node.setAttribute("tabindex", node === nodeToFocus ? "0" : "-1");
            });
          };
          // Make it globally accessible ONLY IF context menu absolutely needs it
          window.setTreeFocusableNode = setFocusableNode;

          function toggleExpansion(buttonNode) {
            // buttonNode now IS the treeitem with aria-expanded
            if (
              !buttonNode ||
              buttonNode.tagName !== "BUTTON" ||
              !buttonNode.hasAttribute("aria-expanded")
            )
              return;

            const isExpanded =
              buttonNode.getAttribute("aria-expanded") === "true";
            const group = getChildGroup(buttonNode); // Use the corrected helper
            const icon = buttonNode.querySelector("i");

            if (group) {
              // Only proceed if the group was found
              // Toggle button attribute
              buttonNode.setAttribute("aria-expanded", String(!isExpanded)); // Use string true/false
              // Toggle group visibility
              group.hidden = isExpanded; // Correct: Hide if it WAS expanded, show if it WAS collapsed

              // Toggle folder icon
              if (icon) {
                icon.classList.toggle("fa-folder", isExpanded); // Show closed icon if it WAS expanded
                icon.classList.toggle("fa-folder-open", !isExpanded); // Show open icon if it WAS collapsed
              }
              console.log(
                `Toggled expansion for "${buttonNode.textContent.trim()}". New state: ${!isExpanded}`
              );
              // Announce state change
              announceStatus(
                `${buttonNode.textContent.trim()} ${
                  !isExpanded ? "expanded" : "collapsed"
                }.`
              );
            } else {
              // Log error if group wasn't found - helps debugging
              console.error(
                `toggleExpansion: Could not find child group for button:`,
                buttonNode
              );
            }
          }

          tree.addEventListener("keydown", (e) => {
            const currentFocusedNode = e.target.closest('[role="treeitem"]');
            if (
              !currentFocusedNode ||
              !focusableTreeNodes.includes(currentFocusedNode)
            )
              return;

            const visibleNodes = getVisibleFocusableNodes();
            const currentIndex = visibleNodes.indexOf(currentFocusedNode);
            let nextNode = null;

            switch (e.key) {
              case "ArrowDown":
                e.preventDefault();
                if (currentIndex < visibleNodes.length - 1) {
                  nextNode = visibleNodes[currentIndex + 1];
                }
                break;
              case "ArrowUp":
                e.preventDefault();
                if (currentIndex > 0) {
                  nextNode = visibleNodes[currentIndex - 1];
                }
                break;
              case "ArrowRight":
                e.preventDefault();
                if (
                  currentFocusedNode.tagName === "BUTTON" &&
                  currentFocusedNode.getAttribute("aria-expanded") === "false"
                ) {
                  toggleExpansion(currentFocusedNode);
                } else if (
                  currentFocusedNode.tagName === "BUTTON" &&
                  currentFocusedNode.getAttribute("aria-expanded") === "true"
                ) {
                  const childGroup = getChildGroup(currentFocusedNode);
                  const firstChildNode = childGroup?.querySelector(
                    ':scope > li[role="none"] > [role="treeitem"]'
                  );
                  if (firstChildNode) nextNode = firstChildNode;
                }
                break;
              case "ArrowLeft":
                e.preventDefault();
                if (
                  currentFocusedNode.tagName === "BUTTON" &&
                  currentFocusedNode.getAttribute("aria-expanded") === "true"
                ) {
                  toggleExpansion(currentFocusedNode);
                } else {
                  const parentNode = getParentTreeitem(currentFocusedNode);
                  if (parentNode) nextNode = parentNode;
                }
                break;
              case "Home":
                e.preventDefault();
                if (visibleNodes.length > 0) nextNode = visibleNodes[0];
                break;
              case "End":
                e.preventDefault();
                if (visibleNodes.length > 0)
                  nextNode = visibleNodes[visibleNodes.length - 1];
                break;
              case "Enter":
              case " ":
                e.preventDefault();
                if (
                  currentFocusedNode.tagName === "BUTTON" &&
                  currentFocusedNode.hasAttribute("aria-expanded")
                ) {
                  toggleExpansion(currentFocusedNode);
                } else if (currentFocusedNode.tagName === "A") {
                  currentFocusedNode.click();
                }
                break;
              default:
                if (e.key.length === 1 && e.key.match(/\S/)) {
                  // --- Basic Typeahead Logic ---
                  e.preventDefault();
                  clearTimeout(typeaheadTimeout);
                  typeaheadBuffer += e.key.toLowerCase();
                  typeaheadTimeout = setTimeout(() => {
                    typeaheadBuffer = "";
                  }, 750);

                  let searchNodes = getVisibleFocusableNodes(); // Search only visible nodes
                  let currentNodeIndex =
                    searchNodes.indexOf(currentFocusedNode);
                  if (currentNodeIndex < 0) currentNodeIndex = 0;
                  let searchIndex = (currentNodeIndex + 1) % searchNodes.length;

                  for (let i = 0; i < searchNodes.length; i++) {
                    const nodeToCheck = searchNodes[searchIndex];
                    if (nodeToCheck) {
                      const nodeText = nodeToCheck.textContent
                        .trim()
                        .toLowerCase();
                      if (nodeText.startsWith(typeaheadBuffer)) {
                        nextNode = nodeToCheck;
                        break;
                      }
                    }
                    searchIndex = (searchIndex + 1) % searchNodes.length;
                    if (
                      searchIndex ===
                      (currentNodeIndex + 1) % searchNodes.length
                    )
                      break;
                  }
                  // --- End Typeahead ---
                }
                break;
            }

            if (nextNode) {
              setFocusableNode(nextNode);
              nextNode.focus({ preventScroll: true });
            }
          });

          tree.addEventListener("click", (e) => {
            const clickedNode = e.target.closest('[role="treeitem"]');
            if (!clickedNode || !focusableTreeNodes.includes(clickedNode))
              return;
            setFocusableNode(clickedNode);
            if (
              clickedNode.tagName === "BUTTON" &&
              clickedNode.hasAttribute("aria-expanded")
            ) {
              toggleExpansion(clickedNode);
            }
          });

          tree.addEventListener("focusin", (e) => {
            if (e.target === tree) {
              const focusableNode = tree.querySelector(
                '[role="treeitem"][tabindex="0"]'
              );
              if (focusableNode) {
                focusableNode.focus();
              } else if (focusableTreeNodes.length > 0) {
                setFocusableNode(focusableTreeNodes[0]);
                focusableTreeNodes[0].focus();
              }
            }
          });

          // Initial setup
          if (focusableTreeNodes.length > 0) {
            const firstNode = focusableTreeNodes[0];
            setFocusableNode(firstNode);
            // Ensure initial hidden states match aria-expanded
            tree
              .querySelectorAll('button[role="treeitem"]')
              .forEach((button) => {
                const group = getChildGroup(button);
                if (group) {
                  group.hidden =
                    button.getAttribute("aria-expanded") !== "true";
                }
              });
          } else {
            console.warn("Treeview: No focusable treeitem nodes found.");
          }

          console.log(
            "Treeview initialized (Pattern: treeitem on interactive element)"
          );
        } else {
          console.log("Treeview container not found");
        }
        // --- End Treeview Implementation ---

        // --- Custom Context Menu Implementation ---
        const contextMenu = document.getElementById("customContextMenu");
        if (contextMenu) {
          const menuItems = Array.from(
            contextMenu.querySelectorAll('[role="menuitem"]')
          );
          const triggerSelectors = '.thumbnail-button, [role="treeitem"]'; // Update selector to target treeitem role directly
          let currentTrigger = null;
          let currentFocusedItemIndex = -1;

          function openContextMenu(triggerElement, x, y) {
            console.log(`Opening context menu for trigger:`, triggerElement);
            currentTrigger = triggerElement;
            contextMenu.hidden = false;
            // Positioning logic... (ensure menu stays in viewport)
            const menuWidth = contextMenu.offsetWidth;
            const menuHeight = contextMenu.offsetHeight;
            const viewportWidth = window.innerWidth;
            const viewportHeight = window.innerHeight;
            let finalX = x;
            let finalY = y;
            if (x + menuWidth > viewportWidth)
              finalX = viewportWidth - menuWidth - 5;
            if (y + menuHeight > viewportHeight)
              finalY = viewportHeight - menuHeight - 5;
            finalX = Math.max(5, finalX);
            finalY = Math.max(5, finalY);
            contextMenu.style.left = `${finalX}px`;
            contextMenu.style.top = `${finalY}px`;

            currentFocusedItemIndex = 0;
            menuItems[currentFocusedItemIndex]?.focus();
          }

          function closeContextMenu() {
            if (contextMenu.hidden) return; // Prevent multiple calls

            const triggerToFocus = currentTrigger;
            contextMenu.hidden = true;
            currentTrigger = null;
            currentFocusedItemIndex = -1;

            if (triggerToFocus) {
              console.log("Closing menu. Returning focus to:", triggerToFocus);
              setTimeout(() => {
                // Check if trigger is Tree item & ensure it's focusable via Treeview's function
                const treeContainer = document.getElementById("resource-tree");
                // Use the globally exposed function if needed
                const treeFocusSetter = window.setTreeFocusableNode; // Access global function
                if (
                  treeContainer &&
                  treeContainer.contains(triggerToFocus) &&
                  typeof treeFocusSetter === "function"
                ) {
                  console.log(
                    "Trigger is in treeview, ensuring it is focusable."
                  );
                  treeFocusSetter(triggerToFocus);
                }
                triggerToFocus.focus({ preventScroll: true });
                console.log(
                  "Active element after focus attempt:",
                  document.activeElement
                );
                if (document.activeElement !== triggerToFocus) {
                  console.warn("Focus did not land on the trigger element.");
                } else {
                  console.log("Focus successfully returned to trigger.");
                }
              }, 0);
            } else {
              console.warn(
                "closeContextMenu called but triggerToFocus was null."
              );
            }
          }

          function focusMenuItem(index) {
            currentFocusedItemIndex = index;
            menuItems[currentFocusedItemIndex]?.focus();
          }

          // Event Listeners for Context Menu (Right Click, Keyboard Trigger, Menu Nav, Outside Click, Item Activation)
          document.body.addEventListener("contextmenu", (e) => {
            const trigger = e.target.closest(triggerSelectors); // Use updated selector
            if (trigger) {
              e.preventDefault();
              openContextMenu(trigger, e.clientX, e.clientY);
            } else {
              closeContextMenu();
            }
          });

          document.body.addEventListener("keydown", (e) => {
            if (e.key === "ContextMenu" || (e.key === "F10" && e.shiftKey)) {
              const trigger = document.activeElement?.closest(triggerSelectors); // Use updated selector
              if (trigger) {
                e.preventDefault();
                const rect = trigger.getBoundingClientRect();
                openContextMenu(trigger, rect.left, rect.bottom + 2);
              }
            }
          });

          contextMenu.addEventListener("keydown", (e) => {
            if (contextMenu.hidden) return;
            let newIndex;
            const totalItems = menuItems.length;
            switch (e.key) {
              case "ArrowDown":
                e.preventDefault();
                newIndex = (currentFocusedItemIndex + 1) % totalItems;
                focusMenuItem(newIndex);
                break;
              case "ArrowUp":
                e.preventDefault();
                newIndex =
                  (currentFocusedItemIndex - 1 + totalItems) % totalItems;
                focusMenuItem(newIndex);
                break;
              case "Home":
                e.preventDefault();
                focusMenuItem(0);
                break;
              case "End":
                e.preventDefault();
                focusMenuItem(totalItems - 1);
                break;
              case "Enter":
              case " ":
                e.preventDefault();
                menuItems[currentFocusedItemIndex]?.click();
                break;
              case "Escape":
                e.preventDefault();
                closeContextMenu();
                break;
              case "Tab":
                closeContextMenu();
                break; // Close on Tab out
            }
          });

          document.addEventListener("click", (e) => {
            if (
              !contextMenu.hidden &&
              !contextMenu.contains(e.target) &&
              e.target !== currentTrigger
            ) {
              closeContextMenu();
            }
          });

          // Item Activation (with random success/failure)
          menuItems.forEach((item) => {
            item.addEventListener("click", (e) => {
              const action = item.textContent.trim();
              const triggerElement = currentTrigger; // Use stored trigger before closeContextMenu clears it
              const triggerDesc =
                triggerElement?.textContent?.trim().substring(0, 30) ||
                "the selected item";
              console.log(
                `Action "${action}" clicked for element: "${triggerDesc}"`
              );

              const successProbability = 0.75;
              const isSuccess = Math.random() < successProbability;
              let announcement = "";

              if (isSuccess) {
                // Generate success message... (use switch statement as before)
                switch (action) {
                  case "Preview":
                    announcement = `Previewing "${triggerDesc}".`;
                    break;
                  case "Rename":
                    announcement = `"${triggerDesc}" is ready for renaming.`;
                    break;
                  case "Duplicate":
                    announcement = `Successfully duplicated "${triggerDesc}".`;
                    break;
                  case "Add to Folder...":
                    announcement = `Successfully added "${triggerDesc}" to folder.`;
                    break;
                  case "Share":
                    announcement = `Sharing options opened for "${triggerDesc}".`;
                    break;
                  case "Delete":
                    announcement = `"${triggerDesc}" was successfully deleted.`;
                    break;
                  default:
                    announcement = `Action "${action}" completed for "${triggerDesc}".`;
                }
                console.log("Simulated Success:", announcement);
                announceStatus(announcement);
              } else {
                // Generate failure message... (use switch statement as before)
                switch (action) {
                  case "Preview":
                    announcement = `Error: Could not load preview for "${triggerDesc}".`;
                    break;
                  case "Rename":
                    announcement = `Error: Failed to initiate rename for "${triggerDesc}".`;
                    break;
                  case "Duplicate":
                    announcement = `Error: Could not duplicate "${triggerDesc}".`;
                    break;
                  case "Add to Folder...":
                    announcement = `Error: Failed to add "${triggerDesc}" to folder.`;
                    break;
                  case "Share":
                    announcement = `Error: Cannot share "${triggerDesc}" at this time.`;
                    break;
                  case "Delete":
                    announcement = `Error: Deletion of "${triggerDesc}" failed.`;
                    break;
                  default:
                    announcement = `Error: Action "${action}" failed for "${triggerDesc}".`;
                }
                console.warn("Simulated Failure:", announcement);
                announceAlert(announcement);
              }
              closeContextMenu(); // Close menu AFTER action/announcement
            });
          });
          console.log("Context menu initialized.");
        } else {
          console.warn("Context menu container not found.");
        }
        // --- End Context Menu Implementation ---

        console.log("All scripts initialized.");
      }); // End DOMContentLoaded
    </script>
  </body>
</html>
